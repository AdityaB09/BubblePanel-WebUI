<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>BubblePanel Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root { --bg:#0b1220; --panel:#0f1629; --text:#e6edf3; --muted:#9fb1c8; --line:#2a2f3a; --acc:#3354ff; }
      html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
      main { max-width:1024px; margin:24px auto; padding:0 16px }
      h2 { margin:0 0 12px 0 }
      .badge { display:inline-block; padding:2px 10px; border-radius:999px; font-weight:600; margin-left:6px }
      .ok{ background:#0f3; color:#041 } .bad{ background:#f90; color:#210 }
      .sec { background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:14px; margin:16px 0 }
      .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:10px 0 }
      label { display:block; font-size:14px; color:var(--muted); margin-bottom:6px }
      input[type="text"], select { width:100%; padding:10px; border-radius:10px; border:1px solid var(--line); background:#0f1629; color:var(--text) }
      input[type="file"]{ color:var(--muted) }
      .btn { padding:10px 14px; border-radius:10px; background:var(--acc); color:#fff; border:0; cursor:pointer; font-weight:600 }
      .btn:disabled { opacity:.55; cursor:not-allowed }
      .pill { margin:4px 6px 0 0; padding:6px 10px; border-radius:999px; border:1px solid #334; background:#121b33; color:var(--text); cursor:pointer }
      pre { white-space:pre-wrap; word-break:break-word; margin:10px 0 0 0 }
      .muted { color:var(--muted) }
      .err { color:#ff8a8a }
      ul { margin:8px 0 0 18px }
      a { color:#7aa2ff; text-decoration:none } a:hover{text-decoration:underline}
    </style>
  </head>
  <body>
    <main>
      <h2>BubblePanel Web</h2>
      <div>Backend: <code id="backendUrl"></code> <span id="statusBadge" class="badge bad">Unknown</span></div>

      <div class="sec">
        <div><b>Command preview</b></div>
        <pre id="cmd">(fill the form below)</pre>
      </div>

      <div class="sec">
        <div style="font-weight:700; margin-bottom:6px">Process Page</div>

        <div class="row">
          <div>
            <label>Input image (server path)</label>
            <input id="input" type="text" placeholder="/app/uploads/..." />
          </div>
          <div>
            <label>Upload image</label>
            <input id="choose" type="file" accept="image/*" />
          </div>
        </div>

        <div class="row">
          <div><label>Output folder</label><input id="out" type="text" value="./data/outputs/web" /></div>
          <div><label>panels.jsonl path</label><input id="jsonl" type="text" value="panels.jsonl" /></div>
        </div>

        <div class="row">
          <div>
            <label>Engine</label>
            <select id="engine">
              <option value="encoder">Encoder (MPNet)</option>
              <option value="llm">Text LLM (Ollama)</option>
            </select>
          </div>
          <div>
            <label>Summary style</label>
            <select id="style">
              <option value="paragraph">Paragraph</option>
              <option value="novel">Novel</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div><label>Text LLM model (Ollama)</label><input id="ollamaModel" type="text" placeholder="qwen2.5:7b-instruct" /></div>
          <div><label>Ollama host</label><input id="host" type="text" placeholder="https://your-ollama.onrender.com" /></div>
        </div>

        <div class="row">
          <div><label>Embed model (encoder)</label><input id="embedModel" type="text" value="sentence-transformers/all-mpnet-base-v2" /></div>
          <div style="display:flex;align-items:end"><label><input id="mlm" type="checkbox" /> Use masked-LM refiner</label></div>
        </div>

        <div class="row">
          <div style="display:flex;align-items:center;gap:8px">
            <input id="summarize" type="checkbox" />
            <label for="summarize" style="margin:0">Summarize page (requires LLM host)</label>
          </div>
          <div class="muted">Leave OFF unless you’ve deployed an accessible Ollama host. Otherwise the pipeline will try 127.0.0.1 and fail.</div>
        </div>

        <div class="row">
          <label><input id="recon" type="checkbox" /> Recon verbose</label>
          <label><input id="savecrops" type="checkbox" /> Save crops</label>
          <label><input id="allocr" type="checkbox" /> All OCR</label>
          <label><input id="ocrverb" type="checkbox" /> OCR verbose</label>
          <label><input id="noocr" type="checkbox" /> Skip OCR</label>
        </div>

        <div style="margin-top:10px"><button id="runBtn" class="btn">Run</button></div>
      </div>

      <div class="sec">
        <div id="presets"></div>
      </div>

      <div class="sec">
        <div id="outputs">Outputs will appear here…</div>
      </div>
    </main>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
